<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UniRide â€” Student Ride Sharing</title>
<style>
body{font-family:'Segoe UI', Tahoma;margin:0;background:#f9f9f9;color:#222;}
header{background: linear-gradient(90deg,#0b3d91,#ffcc00); padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; color:#fff;}
nav button{margin-left:0.5rem;padding:0.5rem 1rem;border:none;border-radius:5px;cursor:pointer;background:#fff;color:#0b3d91;font-weight:bold;transition:0.3s;}
nav button:hover{opacity:0.8;}
.container{max-width:1000px;margin:2rem auto;padding:0 1rem;}
h2,h3{color:#0b3d91;}
.card{background:#fff;padding:1rem;margin-bottom:1rem;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
.btn{padding:0.5rem 1rem;border:none;border-radius:5px;cursor:pointer;}
.btn-primary{background:#0b3d91;color:#fff;}
.btn-success{background:#28a745;color:#fff;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;display:flex;}
.modal-content{background:#fff;padding:2rem;border-radius:10px;width:90%;max-width:400px;position:relative;}
.modal-content label{display:block;margin:0.5rem 0;}
.modal-content input{width:100%;padding:0.5rem;margin-top:0.2rem;}
.modal-content fieldset{margin-top:1rem;border:none;}
.form-actions{margin-top:1rem;display:flex;justify-content:space-between;}
.btn-close{background:#ccc;}
</style>
</head>
<body>

<header>
<h1>UniRide</h1>
<nav>
  <button id="nav-login">Login</button>
  <button id="nav-signup">Sign Up</button>
  <button id="nav-logout" style="display:none">Logout</button>
</nav>
</header>

<div class="container">
<section id="dashboard" style="display:none"></section>
<section id="public-rides">
<h3>Available Rides</h3>
<div id="rides-list">No rides available yet.</div>
</section>
</div>

<!-- Signup Modal -->
<div class="modal" id="modal-signup">
<div class="modal-content">
<h3>Sign Up</h3>
<form id="form-signup">
  <label>Name<input name="name" required></label>
  <label>Email<input type="email" name="email" required></label>
  <label>Password<input type="password" name="password" required></label>
  <label>Phone<input name="phone"></label>
  <fieldset>
    <legend>Role</legend>
    <label><input type="radio" name="role" value="passenger" checked> Passenger</label>
    <label><input type="radio" name="role" value="driver"> Driver</label>
  </fieldset>
  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Create Account</button>
    <button type="button" class="btn btn-close">Cancel</button>
  </div>
</form>
</div>
</div>

<!-- Login Modal -->
<div class="modal" id="modal-login">
<div class="modal-content">
<h3>Login</h3>
<form id="form-login">
  <label>Email<input type="email" name="email" required></label>
  <label>Password<input type="password" name="password" required></label>
  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Login</button>
    <button type="button" class="btn btn-close">Cancel</button>
  </div>
</form>
</div>
</div>

<script>
const modalSignup = document.getElementById('modal-signup');
const modalLogin = document.getElementById('modal-login');
const navLogin = document.getElementById('nav-login');
const navSignup = document.getElementById('nav-signup');
const navLogout = document.getElementById('nav-logout');
const dashboard = document.getElementById('dashboard');
const ridesList = document.getElementById('rides-list');

navSignup.addEventListener('click', ()=>{ modalSignup.style.display='flex'; });
navLogin.addEventListener('click', ()=>{ modalLogin.style.display='flex'; });
document.querySelectorAll('.btn-close').forEach(btn=>btn.addEventListener('click', ()=>{ modalSignup.style.display='none'; modalLogin.style.display='none'; }));

let currentUser = null;

// ===== Signup =====
document.getElementById('form-signup').addEventListener('submit', async e=>{
e.preventDefault();
const f = e.target;
const res = await fetch('/api/signup', {
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({name:f.name.value,email:f.email.value,password:f.password.value,phone:f.phone.value,role:f.role.value})
});
const data = await res.json();
if(res.ok){ currentUser = data.user; modalSignup.style.display='none'; renderDashboard(); updateNav(); } 
else alert(data.message);
});

// ===== Login =====
document.getElementById('form-login').addEventListener('submit', async e=>{
e.preventDefault();
const f = e.target;
const res = await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:f.email.value,password:f.password.value})});
const data = await res.json();
if(res.ok){ currentUser = data.user; modalLogin.style.display='none'; renderDashboard(); updateNav(); }
else alert(data.message);
});

navLogout.addEventListener('click', ()=>{ currentUser=null; dashboard.style.display='none'; updateNav(); });

function updateNav(){ if(currentUser){ navLogin.style.display='none'; navSignup.style.display='none'; navLogout.style.display='inline-block'; } else{ navLogin.style.display='inline-block'; navSignup.style.display='inline-block'; navLogout.style.display='none'; } }

function renderDashboard(){
dashboard.innerHTML=''; dashboard.style.display='block';
if(currentUser.role==='driver'){
const card=document.createElement('div'); card.className='card';
card.innerHTML=`<h3>Driver Dashboard</h3>
<form id='form-ride'>
<label>Origin<input name='origin' required></label>
<label>Destination<input name='destination' required></label>
<label>Date & Time<input type='datetime-local' name='datetime' required></label>
<label>Seats<input type='number' name='seats' required></label>
<label>Price<input type='number' name='price' required></label>
<button class='btn btn-success' type='submit'>Post Ride</button>
</form>`;
dashboard.appendChild(card);
document.getElementById('form-ride').addEventListener('submit', async e=>{
e.preventDefault();
const f=e.target;
const res = await fetch('/api/rides',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({driver:currentUser.name,origin:f.origin.value,destination:f.destination.value,datetime:f.datetime.value,seats:f.seats.value,price:f.price.value})});
const data = await res.json();
if(res.ok){ alert('Ride posted!'); f.reset(); renderRides(); }
});
}
renderRides();
}

async function renderRides(){
const res = await fetch('/api/rides');
const rides = await res.json();
ridesList.innerHTML='';
if(rides.length===0){ ridesList.innerHTML='No rides available.'; return; }
rides.forEach(r=>{
const div=document.createElement('div'); div.className='card';
div.innerHTML=<p><strong>Driver:</strong>${r.driver}</p><p><strong>From:</strong>${r.origin} <strong>To:</strong>${r.destination}</p><p><strong>Date/Time:</strong>${r.datetime}</p><p><strong>Seats:</strong>${r.seats} <strong>Price:</strong>$${r.price}</p>;
if(currentUser && currentUser.role==='passenger'){ const btn=document.createElement('button'); btn.className='btn btn-primary'; btn.textContent='Request Ride'; btn.addEventListener('click', ()=>{ alert('Ride requested successfully!'); }); div.appendChild(btn); }
ridesList.appendChild(div);
});
}

renderRides();
</script>

</body>
</html>
